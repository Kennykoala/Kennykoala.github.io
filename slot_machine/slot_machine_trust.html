<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
        integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
    <link rel="stylesheet" href="equity_slot.css">

    <title>Stock_Slot_Machine_Trust</title>

</head>

<body>
    <div id="mainpage">
        <div id="hmgnav" class="overlay">
            <!-- &times; : Unicode Character  HTML Entity  × -->
            <a href="#" class="closebtn" onclick="closehmgNav()">&#x2192;</a>
            <div class="overlay-content">
                <p>股票柏青嫂</p>
                <a href="slot_machine_foreign.html">外資買超</a>
                <a href="slot_machine_trust.html">投信買超</a>
            </div>
        </div>
        <!-- &#9776; : Unicode Character  HTML Entity  漢堡 -->
        <span id="hmg" style="cursor: pointer;" onclick="openhmgNav()">&#9776;</span>
    </div>



    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <!-- <a class="navbar-brand" href="#">Navbar</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button> -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <!-- <a class="nav-link" aria-current="page" href="#">外資買超</a> -->
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="slot_machine_trust.html">投信買超</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <header>
        <h1>股票柏青嫂
            <span id="txt">數據更新時間:每交易日下午5點</span>
        </h1>
        <h3>投資一定有風險，股票投資有賺有賠，選股資訊僅供參考，審慎判斷，自負風險</h3>
    </header>

    <div class="container">
        <div class="row">
            <div class="col-12" id="btnGroup">
                <button class="" type="button" id="start">試試手氣</button>
                <button class="" type="button" id="refresh">再來一次</button>
            </div>
        </div>
    </div>

    <!-- <h2>外資買超</h2> -->

    <div class="container my-5">
        <div class="row">
            <div class="col-2 card-div">
                <div box-id="1" class="col-2"></div>
                <div back-id="1" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="2" class="col-2"></div>
                <div back-id="2" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="3" class="col-2"></div>
                <div back-id="3" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="4" class="col-2"></div>
                <div back-id="4" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="5" class="col-2"></div>
                <div back-id="5" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="6" class="col-2"></div>
                <div back-id="6" class="col-2"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-2 card-div">
                <div box-id="7" class="col-2"></div>
                <div back-id="7" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="8" class="col-2"></div>
                <div back-id="8" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="9" class="col-2"></div>
                <div back-id="9" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="10" class="col-2"></div>
                <div back-id="10" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="11" class="col-2"></div>
                <div back-id="11" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="12" class="col-2"></div>
                <div back-id="12" class="col-2"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-2 card-div">
                <div box-id="13" class="col-2"></div>
                <div back-id="13" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="14" class="col-2"></div>
                <div back-id="14" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="15" class="col-2"></div>
                <div back-id="15" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="16" class="col-2"></div>
                <div back-id="16" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="17" class="col-2"></div>
                <div back-id="17" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="18" class="col-2"></div>
                <div back-id="18" class="col-2"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-2 card-div">
                <div box-id="19" class="col-2"></div>
                <div back-id="19" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="20" class="col-2"></div>
                <div back-id="20" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="21" class="col-2"></div>
                <div back-id="21" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="22" class="col-2"></div>
                <div back-id="22" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="23" class="col-2"></div>
                <div back-id="23" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="24" class="col-2"></div>
                <div back-id="24" class="col-2"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-2 card-div">
                <div box-id="25" class="col-2"></div>
                <div back-id="25" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="26" class="col-2"></div>
                <div back-id="26" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="27" class="col-2"></div>
                <div back-id="27" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="28" class="col-2"></div>
                <div back-id="28" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="29" class="col-2"></div>
                <div back-id="29" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="30" class="col-2"></div>
                <div back-id="30" class="col-2"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-2 card-div">
                <div box-id="31" class="col-2"></div>
                <div back-id="31" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="32" class="col-2"></div>
                <div back-id="32" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="33" class="col-2"></div>
                <div back-id="33" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="34" class="col-2"></div>
                <div back-id="34" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="35" class="col-2"></div>
                <div back-id="35" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="36" class="col-2"></div>
                <div back-id="36" class="col-2"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-2 card-div">
                <div box-id="37" class="col-2"></div>
                <div back-id="37" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="38" class="col-2"></div>
                <div back-id="38" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="39" class="col-2"></div>
                <div back-id="39" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="40" class="col-2"></div>
                <div back-id="40" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="41" class="col-2"></div>
                <div back-id="41" class="col-2"></div>
            </div>
            <div class="col-2 card-div">
                <div box-id="42" class="col-2"></div>
                <div back-id="42" class="col-2"></div>
            </div>
        </div>


        <div id="msg">個股資訊
            <span id="unit">金額單位:百萬元</span>
        </div>
        <captain> </captain>
        <table>
            <thead>
                <tr>
                    <th>外資買進金額</th>
                    <th>外資賣出金額</th>
                    <th>外資買賣超金額</th>
                    <th>投信買進金額</th>
                    <th>投信賣出金額</th>
                    <th>投信買賣超金額</th>
                    <th>法人近三日買賣超狀況</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <!-- 加入td -->
                </tr>
            </tbody>
        </table>
        <a id="anchor" target="_blank"></a>
    </div>

    <footer>
        <div id="foot">
            <p id="copyright">&copy; Copyright 2021 Kenny. All rights reserved.</p>
            <p>資料參考來源 <a href="https://goodinfo.tw/StockInfo/index.asp" target="_blank">Goodinfo</a></p>
        </div>
    </footer>

    <a href="slot_machine_trust.html" id="gotop">
        <i class="fa fa-angle-up"></i>
    </a>



    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
    <script src="jquery.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="jquery.flip.min.js"></script>


    <script>
        let brickData = [
            {
                // id: "1",
                // color: "black",
                // icon: "fas fa-search-dollar",
                src: "bull-market.png"
                // //走到該格要做什麼事情，this = 自己
                // target: function () {
                //     return this.icon.split("-")[1];  //取得instagram
                //}
            }
        ]

        const BSUrl = "https://raw.githubusercontent.com/Kennykoala/Kennykoala.github.io/master/slot_machine/ranking_trust.json";

        let foreignBSArray, td;
        let steps = 0;     //剩餘步數
        let allsteps = 0;  //全部步數
        let current = 0;   //目前走到哪一格
        let speed;         //速率(愈大代表走愈慢)
        let bricksDiv = document.querySelectorAll(".col-2.card-div");
        let bricksArray = document.querySelectorAll("[box-id]");
        let backBricks = document.querySelectorAll("[back-id]");
        let btnStart = document.querySelector('#start');
        let btnRefresh = document.querySelector('#refresh');
        let bodytr = document.querySelector("tbody tr");
        let a = document.querySelector("#anchor");
        let captain = document.querySelector("captain");
        let hmgnav = document.querySelector("#hmgnav");

        // 打開選單
        function openhmgNav() {
            hmgnav.style.display = "block";
        }
        // 關閉選單
        function closehmgNav() {
            hmgnav.style.display = "none";
        }


        window.onload = function () {
            bricksArray.forEach((div, index) => {
                let icon = document.createElement("img");
                icon.setAttribute("src", brickData[0].src);
                console.log(icon);
                // icon.style.color = brickData.color;
                div.appendChild(icon);
            })
            getData();
        }


        //fetch抓資料
        function getData() {
            var promise1 = fetch(BSUrl);
            promise1
                .then(r => r.text())
                .then(result => {
                    foreignBSArray = JSON.parse(result);    //把json文字轉成array
                    // console.log(BSArray);
                    getBSstock();
                })
                .catch();
        }


        //把股票資料放入div
        function getBSstock() {
            backBricks.forEach((div, index) => {                     //div == 每個含有[box-id]的div
                let idx = index + 1;
                let data = foreignBSArray.find(item => item.排名 == idx);     //找x.id(brickData的id) == idx(box-id)
                // console.log(data);
                let p = document.createElement("p");
                let txt = `${data.代號} <br/> <strong>${data.名稱}</strong> <span>${data.漲跌幅}%<span>`;
                p.innerHTML = txt;

                let span = p.querySelector('span');

                if (data.漲跌幅[0] === '+') { span.style.color = "red" }
                else { span.style.color = "green" };
                // p.setAttribute("class", data.name);
                // icon.style.color = data.color;
                div.appendChild(p);
            });
            // console.log(bricks.length);
        }


        //按下"試試手氣"按鈕
        btnStart.addEventListener("click", function () {
            btnStart.disabled = true;
            speed = 50;  //初始化速率

            let random = Math.floor(Math.random() * bricksArray.length / 2) + 1;
            steps = random + (1 * bricksArray.length);
            allsteps = steps;
            turnAround();
        })

        //走的方式
        function turnAround() {
            bricksArray[current].classList.remove("active");        //移除顏色框
            current += Math.floor(Math.random() * bricksArray.length) + 1;

            //現在的格子超出所有格子總長，歸0
            current %= bricksArray.length;

            bricksArray[current].classList.add('active');
            steps--;

            //延遲執行
            if (steps > 0) {
                //還沒跑完
                setTimeout(turnAround, speed);

                if (steps < Math.floor((allsteps / 3))) { speed += 7 };   //當剩餘步數小於全部步數的1/3時，做減速動作，這邊是減速，因為speed越大速度越慢

            } else {
                //跑完了，顯示個股資訊內容
                bricksDiv[current].classList.add('flip');

                captain.innerHTML = `${foreignBSArray[current].代號}&nbsp;${foreignBSArray[current].名稱}&emsp;${foreignBSArray[current].漲跌幅 + "%"}`;

                let valArray = [foreignBSArray[current].外資買進金額, foreignBSArray[current].外資賣出金額, foreignBSArray[current].外資買賣超金額, foreignBSArray[current].投信買進金額, foreignBSArray[current].投信賣出金額, foreignBSArray[current].投信買賣超金額, foreignBSArray[current].法人買賣超註記];

                valArray.forEach(item => {
                    td = document.createElement("td");
                    td.innerText = item;
                    bodytr.appendChild(td);
                })

                a.innerText = "獲取更多個股訊息";
                a.setAttribute("href", `https://goodinfo.tw/StockInfo/StockDetail.asp?STOCK_ID=${foreignBSArray[current].代號}`)
                goDown();

            }
        }

        //跳轉到HTML最底部
        function goDown() {
            $('html, body').animate({ scrollTop: $(document).height() }, 'fast');
            // $('html, body').animate({ scrollBottom: 0 }, 'fast');
            // $('html, body').scrollBottom(0);
        }


        //按下"重來"按鈕
        btnRefresh.addEventListener("click", function () {
            btnStart.disabled = false;
            bodytr.innerHTML = "";
            a.innerText = "";
            captain.innerHTML = "";
            bricksArray[current].classList.remove("active");     //移除顏色框
            bricksDiv[current].classList.remove('flip');
        })


        //gotop
        $(function () {
            // 按下gotop按鈕事件 
            $('#gotop').click(function () {
                $('html,body').animate({ scrollTop: 0 }, 'fast');   //返回到最頂 
                return false;
            });

            //卷軸滑動時，往下滑超過400px就讓gotop按鈕出現 
            $(window).scroll(function () {
                if ($(this).scrollTop() > 400) {
                    $('#gotop').fadeIn();
                } else {
                    $('#gotop').fadeOut();
                }
            });
        });


    </script>

</body>

</html>